<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Syncronix - Tu Asistente Virtual</title>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: url('fondo.jpg') no-repeat center center fixed;
            background-size: cover;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }
        .chat-container {
            background-color: #fff;
            border-radius: 12px; /* Bordes más redondeados */
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15); /* Sombra más pronunciada */
            width: 450px; /* Ancho ligeramente mayor */
            max-width: 100%; /* Asegurar que sea responsivo */
            overflow: hidden;
            display: flex; /* Usar flexbox para el layout interno */
            flex-direction: column;
            height: 600px; /* Altura fija para el contenedor del chat */
            animation: popIn 0.7s;
        }

        @keyframes popIn {
            0% {
                opacity: 0;
                transform: scale(0.8);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }
        .chat-header {
            background-color: #2196F3; /* Azul para el encabezado */
            color: white;
            padding: 18px;
            text-align: center;
            font-size: 1.3em;
            font-weight: bold;
            border-bottom: 1px solid #1976D2; /* Un azul más oscuro para el borde */
            border-top-left-radius: 12px; /* Bordes redondeados en el header */
            border-top-right-radius: 12px;
            display: flex; /* Para alinear el icono y el texto */
            align-items: center;
            justify-content: center;
        }
        .chat-header img {
            height: 30px; /* Tamaño del icono */
            margin-right: 10px; /* Espacio entre el icono y el texto */
            vertical-align: middle; /* Alineación vertical */
        }
        .chat-box {
            padding: 20px;
            flex-grow: 1; /* Permite que el chat-box ocupe el espacio restante */
            overflow-y: auto; /* Scroll para mensajes */
            display: flex; /* Usar flexbox para los mensajes */
            flex-direction: column;
        }
        .message {
            animation: fadeInUp 0.5s;
            margin-bottom: 12px;
            padding: 10px 15px;
            border-radius: 8px; /* Bordes más redondeados para mensajes */
            max-width: 75%; /* Limitar el ancho del mensaje */
            word-wrap: break-word; /* Romper palabras largas */
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); /* Sombra sutil en los mensajes */
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .user-message {
            background-color: #e0e0e0; /* Gris para la pregunta del usuario */
            align-self: flex-end; /* Alinear a la derecha */
            color: #333; /* Color de texto oscuro para el contraste */
        }
        .syncronix-message {
            background-color: #ffffff; /* Blanco para la respuesta de Syncronix */
            align-self: flex-start; /* Alinear a la izquierda */
            color: #333; /* Color de texto oscuro para el contraste */
            border: 1px solid #ddd; /* Borde sutil para mensajes blancos */
        }
        .chat-input {
            display: flex;
            padding: 15px;
            border-top: 1px solid #eee;
            background-color: #f9f9f9;
            border-bottom-left-radius: 12px; /* Bordes redondeados en el input */
            border-bottom-right-radius: 12px;
        }
        .chat-input input {
            flex-grow: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 25px; /* Input más redondeado */
            margin-right: 10px;
            font-size: 1em;
            outline: none; /* Quitar el contorno al enfocar */
        }
        .chat-input button {
            background-color: #2196F3; /* Azul para el botón, a juego con el encabezado */
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px; /* Botón más redondeado */
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: background-color 0.3s ease; /* Transición suave al pasar el ratón */
        }
        .chat-input button:hover {
            background-color: #1976D2; /* Un azul más oscuro al pasar el ratón */
            transform: translateY(-3px) scale(1.05); /* Efecto de elevación al pasar el ratón */
        }

        /* Responsive adjustments */
        @media (max-width: 600px) {
            .chat-container {
                width: 100%;
                height: 95vh; /* Ocupar casi toda la altura en móviles */
                border-radius: 0; /* Sin bordes redondeados en pantalla completa */
            }
            body {
                padding: 0;
            }
            .chat-header {
                border-radius: 0;
            }
            .chat-input {
                border-radius: 0;
            }
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <img src="logo.jpg" alt="Icono de Syncronix" onerror="this.onerror=null;this.src='https://placehold.co/30x30/cccccc/333333?text=Bot';" />
            Syncronix - Tu Asistente Virtual
        </div>
        <div class="chat-box" id="chatBox">
            </div>
        <div class="chat-input">
            <input type="text" id="userInput" placeholder="Escribe tu mensaje..." onkeypress="handleInitialInput(event)">
            <button onclick="handleInitialInput({key: 'Enter'})">Enviar</button>
        </div>
        <input type="date" id="calendarInput" style="display:none;" />
    </div>

    <script>
        const chatBox = document.getElementById('chatBox');
        const userInput = document.getElementById('userInput');
        const calendarInput = document.getElementById('calendarInput');

        let userName = '';
        let expectingName = true; // Nuevo estado para controlar si esperamos el nombre del usuario

        // Cuando Syncronix pida la fecha:
        function showCalendar() {
            calendarInput.style.display = 'block';
            calendarInput.focus();
            calendarInput.value = '';
            calendarInput.onchange = function() {
                if (calendarInput.value) {
                    tempDate = calendarInput.value.split('-').reverse().join('/');
                    appendMessage('user', tempDate);
                    calendarInput.style.display = 'none';
                    pendingDate = false;
                    if (!tempTime) {
                        pendingTime = true;
                        appendMessage('syncronix', '¿A qué hora? (ejemplo: 3 PM o 15:00)');
                    }
                }
            };
        }

        function appendMessage(sender, text) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message');
            messageDiv.classList.add(sender === 'user' ? 'user-message' : 'syncronix-message');
            messageDiv.textContent = text;
            chatBox.appendChild(messageDiv);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        function resetStates() {
            schedulingMeeting = false;
            schedulingAlarm = false;
            pendingDate = false;
            pendingTime = false;
            tempType = "";
            tempDate = "";
            tempTime = "";
        }

        // Variables de estado
        let schedulingMeeting = false;
        let schedulingAlarm = false;
        let pendingDate = false;
        let pendingTime = false;
        let tempType = ""; // "reunion" o "alarma"
        let tempDate = "";
        let tempTime = "";

        // Nueva función para manejar el input inicial (el nombre)
        function handleInitialInput(event) {
            if (event.key === 'Enter' || event.type === 'click') { // Agrega event.type === 'click' para el botón
                const name = userInput.value.trim();
                if (name && expectingName) {
                    userName = name;
                    appendMessage('user', userName);
                    appendMessage('syncronix', `¡Bienvenido, ${userName}! ¿En qué puedo ayudarte hoy?`);
                    userInput.value = '';
                    userInput.placeholder = "Escribe tu mensaje...";
                    expectingName = false; // Ya no esperamos el nombre
                    userInput.onkeypress = handleKeyPress; // Reasignar a la función de manejo normal
                    document.querySelector('.chat-input button').onclick = sendMessage; // Reasignar el clic del botón
                    userInput.focus();
                } else if (!expectingName) {
                    sendMessage(); // Si ya no esperamos el nombre, procede con la lógica normal
                }
            }
        }

        function sendMessage() {
            const userText = userInput.value.trim();
            if (userText === '') return;

            appendMessage('user', userText);
            userInput.value = '';

            const lowerCaseText = userText.toLowerCase();

            // Pregunta por hora o fecha
            if (
                lowerCaseText.includes('que hora es hoy') || lowerCaseText.includes('que hora es') ||
                lowerCaseText.includes('la hora actual') || lowerCaseText.includes('que fecha es hoy') ||
                lowerCaseText.includes('que fecha es') || lowerCaseText.includes('la fecha actual') ||
                lowerCaseText.includes('quiero saber la hora') ||
                lowerCaseText.includes('me gustaria saber la hora') ||
                lowerCaseText.includes('dime la hora') ||
                lowerCaseText.includes('hora actual')
            ) {
                const now = new Date();
                const timeOptions = { hour: '2-digit', minute: '2-digit', hour12: true };
                const timeString = now.toLocaleTimeString('es-VE', timeOptions);
                const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                const dateString = now.toLocaleDateString('es-VE', dateOptions);
                appendMessage('syncronix', `Son las ${timeString} del ${dateString}.`);
                resetStates();
            }
            // Proceso de agendar reunión o alarma (flujo guiado)
            else if (pendingDate || pendingTime) {
                // Extraer fecha y hora si están pendientes
                let dateMatch = userText.match(/(\d{1,2}\/\d{1,2}\/\d{2,4})|(\d{4}-\d{2}-\d{2})|(\d{1,2} de [a-záéíóú]+( de \d{4})?)/i);
                let timeMatch = userText.match(/(\d{1,2}(:\d{2})?\s*(am|pm)?)|(a las \d{1,2}(:\d{2})?\s*(am|pm)?)/i);

                if (pendingDate && dateMatch) {
                    tempDate = dateMatch[0];
                    pendingDate = false;
                }
                if (pendingTime && timeMatch) {
                    tempTime = timeMatch[0].replace('a las ', '').trim();
                    pendingTime = false;
                }

                // Si falta alguno, preguntar por lo que falta
                if (!tempDate && (tempType === "reunion" || tempType === "alarma")) {
                    pendingDate = true;
                    appendMessage('syncronix', '¿Para qué día? Selecciona una fecha en el calendario:');
                    showCalendar();
                } else if (!tempTime && (tempType === "reunion" || tempType === "alarma")) {
                    pendingTime = true;
                    appendMessage('syncronix', '¿A qué hora? (ejemplo: 3 PM o 15:00)');
                } else {
                    // Confirmar la acción
                    if (tempType === "reunion") {
                        appendMessage('syncronix', `¡Listo! La reunión ha sido agendada para el ${tempDate} a las ${tempTime}.`);
                    } else if (tempType === "alarma") {
                        appendMessage('syncronix', `¡Perfecto! La alarma ha sido programada para el ${tempDate} a las ${tempTime}.`);
                    }
                    resetStates();
                }
            }
            // Solicitud de agendar reunión
            else if (
                lowerCaseText.includes('agendar reunión') ||
                lowerCaseText.includes('agendar reunion') ||
                lowerCaseText.includes('programar reunión') ||
                lowerCaseText.includes('programar reunion') ||
                lowerCaseText.includes('crear reunión') ||
                lowerCaseText.includes('crear reunion')
            ) {
                tempType = "reunion";
                pendingDate = true;
                appendMessage('syncronix', 'Claro, ¿para qué día quieres agendar la reunión? (ejemplo: 21/07/2025 o 21 de julio de 2025)');
            }
            // Solicitud de agendar alarma
            else if (
                lowerCaseText.includes('programar alarma') ||
                lowerCaseText.includes('agendar alarma') ||
                lowerCaseText.includes('poner alarma') ||
                lowerCaseText.includes('configurar alarma')
            ) {
                tempType = "alarma";
                pendingDate = true;
                appendMessage('syncronix', '¡Por supuesto! ¿Para qué día quieres la alarma? (ejemplo: 21/07/2025 o 21 de julio de 2025)');
            }
            // Pregunta por el nombre (si no se ha definido al inicio)
            else if (lowerCaseText.includes('como te llamas') || lowerCaseText.includes('cuál es tu nombre')) {
                if (userName) {
                    appendMessage('syncronix', `Mi nombre es Syncronix. ¡Un placer conocerte, ${userName}!`);
                } else {
                    appendMessage('syncronix', 'Mi nombre es Syncronix. ¿Cuál es tu nombre?');
                    expectingName = true;
                    userInput.placeholder = "Escribe tu nombre...";
                    userInput.onkeypress = handleInitialInput;
                    document.querySelector('.chat-input button').onclick = function() { handleInitialInput({key: 'Enter'}); };
                }
            }
            // Pregunta por los creadores
            else if (
                lowerCaseText.includes('quien te creo') ||
                lowerCaseText.includes('quien te hizo') ||
                lowerCaseText.includes('tus creadores')
            ) {
                appendMessage('syncronix', 'Fui creado por Oscar Jimenez, Isaac Martinez y Miguel Montenegro, estudiantes del Politécnico Santiago Mariño extensión Caracas.');
            }
            // Respuesta predeterminada
            else {
                appendMessage('syncronix', 'Lo siento, no entendí la pregunta. Puedes reformularla de nuevo o preguntarme otra cosa.');
            }
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
            window.history.pushState({}, '', '/Syncronix.com');
        }

        // Llama a esta función al cargar la página para iniciar el flujo
        window.onload = function() {
            appendMessage('syncronix', '¡Hola! ¿Cómo te llamas?');
            userInput.placeholder = "Escribe tu nombre...";
            userInput.focus();
            // Ya el onkeypress y el onclick están configurados para handleInitialInput
        };
    </script>
</body>
</html>
